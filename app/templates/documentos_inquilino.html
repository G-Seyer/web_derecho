<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Subir documentos – Inquilino</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}?v=9">
  <style>
    .card.full{width:100%;max-width:100%}
    .page-docs .form-label{display:block;margin-bottom:.35rem}
    .page-docs input[type="file"]{display:block;width:100%}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .doc-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .doc-card{border:1px solid rgba(13,110,253,.12);border-radius:14px;padding:14px;background:#fff}
    .doc-status{display:flex;align-items:center;gap:.5rem}
    .doc-dot{width:.6rem;height:.6rem;border-radius:50%;background:#adb5bd;display:inline-block}
    .doc-card.ok .doc-dot{background:#198754}
  </style>
</head>
<body>
<header class="barra-superior solid">
  <div class="menu-links" id="menu">
    <a href="/">Inicio</a>
    <a href="/#servicios">Servicios</a>
    <a href="/contacto">Contacto</a>
  </div>
</header>

<div class="container page-docs py-4">
  <h1 class="mb-4">Subir documentos – Inquilino (Arrendatario)</h1>

  <form method="POST" action="{{ url_for('main.subir_inquilino') }}" enctype="multipart/form-data" id="form-inquilino">

    <!-- FOLIO -->
    <div class="card full mb-3">
      <div class="card-body">
        <label class="form-label">Folio asignado</label>
        <div class="d-flex gap-2 flex-wrap">
          <input type="text" name="folio" id="folio" class="form-control mono" style="max-width:360px"
                 placeholder="Ej. AEPRA-202508-AB12"
                 required
                 pattern="^AEPRA-\d{6}-[A-Z0-9]{4}$">
          <button class="btn btn-primary" type="button" id="btn-verificar">Verificar folio</button>
          <span id="folio-msg" class="align-self-center small text-muted">Debes verificar tu folio para habilitar el formulario.</span>
        </div>
      </div>
    </div>

    <!-- DATOS DEL INQUILINO -->
    <div class="card full mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">Datos del inquilino</h2>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre completo</label>
            <input type="text" name="nombre" class="form-control folio-locked" required disabled>
          </div>
          <div class="col-md-6">
            <label class="form-label">E-mail</label>
            <input type="email" name="correo" class="form-control folio-locked" required disabled>
            <div class="form-text">Usa un correo <code>@gmail.com</code>.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Dirección actual</label>
            <input type="text" name="direccion_actual" class="form-control folio-locked" placeholder="Calle Número Colonia" required disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">RFC</label>
            <input type="text" name="rfc" class="form-control folio-locked" maxlength="13" style="text-transform:uppercase" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">CURP</label>
            <input type="text" name="curp" class="form-control folio-locked" maxlength="18" style="text-transform:uppercase" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Lugar de nacimiento</label>
            <input type="text" name="lugar_nacimiento" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Teléfono</label>
            <input type="tel" name="telefono" class="form-control folio-locked" placeholder="55XXXXXXXX" disabled>
          </div>
        </div>
      </div>
    </div>

    <!-- EMPLEO -->
    <div class="card full mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">Datos de empleo</h2>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre de la fuente de empleo</label>
            <input type="text" name="empleo_nombre" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-6">
            <label class="form-label">Dirección de su fuente de empleo</label>
            <input type="text" name="empleo_direccion" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Puesto</label>
            <input type="text" name="puesto" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Monto de sus ingresos</label>
            <input type="number" step="0.01" name="ingresos" class="form-control folio-locked" placeholder="0.00" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Antigüedad</label>
            <input type="text" name="antiguedad" class="form-control folio-locked" placeholder="Ej. 2 años 3 meses" disabled>
          </div>
        </div>
      </div>
    </div>

    <!-- COHABITACIÓN -->
    <div class="card full mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">Personas que habitarán el inmueble</h2>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">¿Cuántas personas habitarán?</label>
            <input type="number" min="1" name="num_habitantes" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-8">
            <label class="form-label">Nombres de las personas que habitarán</label>
            <textarea name="nombres_habitantes" class="form-control folio-locked" rows="2" placeholder="Separados por coma" disabled></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Fuente de empleo de cada persona</label>
            <textarea name="empleo_habitantes" class="form-control folio-locked" rows="2" placeholder="Una por línea, en el mismo orden de los nombres" disabled></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- REFERENCIAS -->
    <div class="card full mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">Referencias</h2>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre de referencia 1</label>
            <input type="text" name="ref1_nombre" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">Relación con el interesado</label>
            <input type="text" name="ref1_relacion" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">Teléfono</label>
            <input type="tel" name="ref1_telefono" class="form-control folio-locked" disabled>
          </div>
          <div class="col-12">
            <label class="form-label">Dirección</label>
            <input type="text" name="ref1_direccion" class="form-control folio-locked" disabled>
          </div>
        </div>

        <hr class="my-3">

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre de referencia 2</label>
            <input type="text" name="ref2_nombre" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">Relación con el interesado</label>
            <input type="text" name="ref2_relacion" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">Teléfono</label>
            <input type="tel" name="ref2_telefono" class="form-control folio-locked" disabled>
          </div>
          <div class="col-12">
            <label class="form-label">Dirección</label>
            <input type="text" name="ref2_direccion" class="form-control folio-locked" disabled>
          </div>
        </div>
      </div>
    </div>

    <!-- AVAL -->
    <div class="card full mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">Obligado solidario / Aval</h2>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre del aval</label>
            <input type="text" name="aval_nombre" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-6">
            <label class="form-label">Lugar y fecha de nacimiento</label>
            <input type="text" name="aval_lugar_fecha_nac" class="form-control folio-locked" placeholder="Ej. CDMX, 01/01/1980" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">RFC</label>
            <input type="text" name="aval_rfc" class="form-control folio-locked" maxlength="13" style="text-transform:uppercase" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">CURP</label>
            <input type="text" name="aval_curp" class="form-control folio-locked" maxlength="18" style="text-transform:uppercase" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Dirección</label>
            <input type="text" name="aval_direccion" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-2">
            <label class="form-label">Teléfono</label>
            <input type="tel" name="aval_telefono" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-6">
            <label class="form-label">Folio real de la propiedad en garantía</label>
            <input type="text" name="aval_folio_real" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-6">
            <label class="form-label">Lugar donde se registró la propiedad en garantía</label>
            <input type="text" name="aval_lugar_registro" class="form-control folio-locked" disabled>
          </div>
        </div>
      </div>
    </div>

    <!-- DATOS DEL INMUEBLE A RENTAR -->
    <div class="card full mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">Datos del inmueble a rentar</h2>
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label">Dirección completa (del inmueble)</label>
            <input type="text" name="direccion" class="form-control folio-locked"
                   placeholder="Calle Número Colonia"
                   required disabled
                   pattern="^\s*\S+(?:\s+\S+)*\s+\d+[\w/-]*\s+\S+(?:\s+\S+)*\s*$">
            <div class="form-text">Orden: <strong>Calle Número Colonia</strong>. Ej.: <code>Insurgentes Sur 716 Del Valle</code>.</div>
          </div>
          <div class="col-md-4">
            <label class="form-label">Tipo de inmueble</label>
            <input type="text" name="tipo_inmueble" class="form-control folio-locked" placeholder="Casa, depto, local..." disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Precio de renta</label>
            <input type="number" step="0.01" name="precio_renta" class="form-control folio-locked" placeholder="0.00" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Fecha de inicio de la renta</label>
            <input type="date" name="fecha_inicio_renta" class="form-control folio-locked" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Fecha de firma del contrato</label>
            <input type="date" name="fecha_firma_contrato" class="form-control folio-locked" disabled>
          </div>
        </div>
      </div>
    </div>

    <!-- DOCUMENTOS A SUBIR -->
    <div class="doc-grid">
      <div class="doc-card" data-field="identificacion">
        <div class="fw-semibold mb-1">🪪 Copia de identificación oficial vigente</div>
        <input id="identificacion" type="file" name="identificacion" accept=".pdf,image/*" required class="folio-locked" disabled>
        <div class="doc-file small text-secondary mt-2">Sin archivo</div>
        <div class="doc-status mt-2"><span class="doc-dot"></span><span class="doc-text">Pendiente</span></div>
      </div>

      <div class="doc-card" data-field="predial_inmueble">
        <div class="fw-semibold mb-1">🧾 Copia de predial del inmueble a rentar</div>
        <input id="predial_inmueble" type="file" name="predial_inmueble" accept=".pdf,image/*" required class="folio-locked" disabled>
        <div class="doc-file small text-secondary mt-2">Sin archivo</div>
        <div class="doc-status mt-2"><span class="doc-dot"></span><span class="doc-text">Pendiente</span></div>
      </div>

      <div class="doc-card" data-field="escritura_inmueble">
        <div class="fw-semibold mb-1">📄 Copia de escritura del inmueble a rentar</div>
        <input id="escritura_inmueble" type="file" name="escritura_inmueble" accept=".pdf,image/*" required class="folio-locked" disabled>
        <div class="doc-file small text-secondary mt-2">Sin archivo</div>
        <div class="doc-status mt-2"><span class="doc-dot"></span><span class="doc-text">Pendiente</span></div>
      </div>

      <div class="doc-card" data-field="domicilio_inmueble">
        <div class="fw-semibold mb-1">🏠 Comprobante de domicilio del inmueble a rentar</div>
        <input id="domicilio_inmueble" type="file" name="domicilio_inmueble" accept=".pdf,image/*" required class="folio-locked" disabled>
        <div class="doc-file small text-secondary mt-2">Sin archivo</div>
        <div class="doc-status mt-2"><span class="doc-dot"></span><span class="doc-text">Pendiente</span></div>
      </div>

      <div class="doc-card" data-field="folio_real">
        <div class="fw-semibold mb-1">📘 Constancia de folio real</div>
        <input id="folio_real" type="file" name="folio_real" accept=".pdf,image/*" required class="folio-locked" disabled>
        <div class="doc-file small text-secondary mt-2">Sin archivo</div>
        <div class="doc-status mt-2"><span class="doc-dot"></span><span class="doc-text">Pendiente</span></div>
      </div>

      <div class="doc-card" data-field="contrato_poder">
        <div class="fw-semibold mb-1">📑 Contrato o poder notarial (si es persona moral)</div>
        <input id="contrato_poder" type="file" name="contrato_poder" accept=".pdf,image/*" class="folio-locked" disabled>
        <div class="form-text">Opcional para persona física.</div>
        <div class="doc-file small text-secondary mt-2">Sin archivo</div>
        <div class="doc-status mt-2"><span class="doc-dot"></span><span class="doc-text">Pendiente</span></div>
      </div>
    </div>

    <div class="mt-4">
      <button id="btn-inquilino" class="btn btn-primary" disabled>Enviar documentos</button>
      <a href="/" class="btn btn-secondary ms-2">Cancelar</a>
    </div>
  </form>
</div>

<script>
  (function(){
    const form = document.getElementById('form-inquilino');
    const email = form.querySelector('input[name="correo"]');
    const dir = form.querySelector('input[name="direccion"]');

    function validaGmail(){
      if(!/@gmail\.com\s*$/i.test(email.value.trim())) email.setCustomValidity('El correo debe ser @gmail.com');
      else email.setCustomValidity('');
    }
    function validaDireccion(){
      if(!dir.checkValidity()) dir.setCustomValidity('Formato: Calle Número Colonia (en ese orden)');
      else dir.setCustomValidity('');
    }
    email.addEventListener('input', validaGmail);
    dir.addEventListener('input', validaDireccion);
  })();
</script>

<script>
(function(){
  const form = document.getElementById('form-inquilino');
  const folio = document.getElementById('folio');
  const btnVer = document.getElementById('btn-verificar');
  const msg = document.getElementById('folio-msg');
  const lockables = Array.from(document.querySelectorAll('.folio-locked'));
  const submitBtn = document.getElementById('btn-inquilino');

  function requiredFiles(){
    return Array.from(form.querySelectorAll('.doc-card input[type="file"][required]'));
  }
  function allFilesOk(){
    return requiredFiles().every(i => i.files && i.files.length>0);
  }
  function setLocked(lock){
    lockables.forEach(el => el.disabled = lock);
    submitBtn.disabled = lock || !allFilesOk();
  }
  setLocked(true);

  btnVer.addEventListener('click', async ()=>{
    const v = folio.value.trim().toUpperCase();
    if(!/^AEPRA-\d{6}-[A-Z0-9]{4}$/.test(v)){
      msg.textContent='Formato inválido. Ejemplo: AEPRA-202508-AB12';
      msg.className='align-self-center small text-danger';
      setLocked(true);
      return;
    }
    try{
      const r = await fetch('/admin/verificar-folio?folio='+encodeURIComponent(v));
      const j = await r.json();
      if(j.ok){
        msg.textContent='Folio verificado ✓';
        msg.className='align-self-center small text-success';
        setLocked(false);
        folio.value=v;
      }else{
        msg.textContent=j.msg||'Folio no válido';
        msg.className='align-self-center small text-danger';
        setLocked(true);
      }
    }catch(e){
      msg.textContent='No se pudo verificar en este momento';
      msg.className='align-self-center small text-danger';
      setLocked(true);
    }
  });

  // UX archivos
  const inputs = Array.from(document.querySelectorAll('.doc-card input[type="file"]'));
  function shortName(name){ if(!name) return "Sin archivo"; return name.length>38?name.slice(0,18)+'…'+name.slice(-16):name; }
  function updateCard(input){
    const card = input.closest('.doc-card'); const ok = input.files && input.files.length>0;
    card.classList.toggle('ok', ok);
    const fn = card.querySelector('.doc-file'); if(fn) fn.textContent = ok?shortName(input.files[0].name):'Sin archivo';
    const st = card.querySelector('.doc-text'); if(st) st.textContent = ok?'Listo':'Pendiente';
    submitBtn.disabled = submitBtn.disabled || !allFilesOk();
  }
  inputs.forEach(i=>{ i.addEventListener('change', ()=>updateCard(i)); updateCard(i); });
})();
</script>

<script>
(function(){
  const header=document.querySelector('.barra-superior'); if(!header) return;
  const set=()=>document.documentElement.style.setProperty('--header-h',header.offsetHeight+'px');
  set(); window.addEventListener('resize',set);
})();
</script>
</body>
</html>
